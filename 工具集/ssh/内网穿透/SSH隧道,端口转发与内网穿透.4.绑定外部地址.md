# SSH隧道,端口转发与内网穿透.4.绑定外部地址

参考文章

1. [SSH隧道技术简介](http://blog.sina.com.cn/s/blog_6ca2bddf0100rljn.html)
2. [SSH的三种端口转发](https://jeremyxu2010.github.io/2018/12/ssh%E7%9A%84%E4%B8%89%E7%A7%8D%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/)
3. [windows10自带ssh实现远程内网主机](https://blog.csdn.net/zhj082/article/details/80795998)
    - win10自带的ssh客户端的使用方法与linux的相同

在使用上一篇文章的`2.1`和`2.3`时, 映射的端口只能绑定在第三方服务器的`127.0.0.1`这个接口上. 也就是说, 只能被本机自己访问到, 要访问到被穿透的内网, 要先登录第三方服务器再跳转一次才行. 如何才能让其他机器访问这个端口呢? 直接通过`第三方服务器IP:映射的端口`去访问内网?

我们可以把这个映射的端口绑定在`0.0.0.0`的接口上, ~~方法是加上参数`-b 0.0.0.0`. 如下~~

~~ssh -N -f -L 2222:目标服务器IP:22 -b 0.0.0.0 root@中转服务器IP~~

~~ssh -N -f -D 1080 -b 0.0.0.0 root@中转服务器IP~~

`-b`参数没什么用, 参考文章2中说到, `-R`选项的用法为`-R [登录主机:]登录主机端口:本地网络主机:本地网络主机端口`, 所以把`[登录主机]`的部分写为`0.0.0.0`.

```
ssh -N -f -R 0.0.0.0:2222:127.0.0.1:22 root@中转服务器IP
```

同时**SSH服务端**还需要打开`GatewayPorts`选项. 默认情况下它应当是被打开的. 如果被关闭的话, 可以在`/etc/sshd_config`中修改`GatewayPorts no`为`GatewayPorts yes`, 并重启sshd服务.

这样在中转服务端就有了在`0.0.0.0`接口上的监听

```
netstat -nlp | grep 2222
tcp        0      0 0.0.0.0:2222          0.0.0.0:*               LISTEN      32241/sshd: root
tcp6       0      0 :::2222                 :::*                    LISTEN      787/sshd: root
```
