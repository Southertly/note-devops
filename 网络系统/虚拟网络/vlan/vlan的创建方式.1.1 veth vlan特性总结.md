# vlan的创建方式.1.1 veth vlan特性总结

## 1. 

可能的完整的网络拓扑如下.

```
  10.1.1.1/24
 +-----------+     +-------+   +-------+     +-----------+     +-------+
 | veth1.100 | <-> | veth1 |   | veth2 | <-> | veth2.100 | <-> | mybr0 | <-> ...
 +-----------+     +---↑---+   +---↑---+     +-----------+     +-------+
                       └───────────┘                       
```

数据包传递流程解析:

1. 数据包在`veth1.100 -> veth1 -> veth2 -> veth2.100`流动中(`veth1.100`为数据包起点), 会被`veth1.100`添加上`vlan tag`; 
2. 在抓包时, `veth1`和`veth2`设备上的数据包都会带有`vlan tag`, 值为100; 而`veth1.100`和`veth2.100`的都没有`vlan tag`. 
3. 如果`veth2.100`接入了`mybr0`, 且接入端口带有`pvid`标记, 那么由`veth2.100`传入的数据包可以被成功接收并转发.
4. `veth1`设备类似于网线, 会对`vlan tag`的数据包进行透传, 不会干预.

## 2.

```
10.1.1.1/24
 +-------+   +-------+     +-----------+     +-------+
 | veth1 |   | veth2 | <-> | veth2.100 | <-> | mybr0 | <-> ...
 +---↑---+   +---↑---+     +-----------+     +-------+
     └───────────┘                       
```

数据包在`veth1 -> veth2 -> veth2.100`这条路上根本走不通. 在抓包时, `veth2.100`上根本捕获不到数据包, 更别说向右传递了.

可以说, **如果`veth2.100`的一端连接的不是ta所属的`veth`设备, 那么ta所流出的数据包一定不会带有`vlan tag`**.

## 3. 

```
                                                                  10.1.1.1/24
       +-------+     +-----------+     +-------+   +-------+     +-----------+ 
...<-> | mybr0 | <-> | veth1.100 | <-> | veth1 |   | veth2 | <-> | veth2.100 | 
       +-------+     +-----------+     +---↑---+   +---↑---+     +-----------+ 
                                           └───────────┘                       
```

1. 从`veth1.100`接入`mybr0`的端口流出的数据包, 不管有没有带`vlan tag`, 也不管`vlan tag`中的值是多少, 最终都会被`veth1.100`修改为100.

